{% extends "base.html" %}
{% block title %}Portland Trails{% endblock %}
{% block head %}

<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>

<h3>Portland Trails</h3>
<!--The div element for the map -->

<label for="trail">Trail Finder:</label>
<input name="filter" min="1" max="20" id="TrailName">

<label for="difficulty">Difficulty:</label>
<select name="filter" id="Difficulty">
  <option value="easy">Easy</option>
  <option value="medium">Medium</option>
  <option value="hard">Hard</option>
</select> 

<label for="length">Length:</label>
<input type="range" min="1" max="30" value="15" class="slider" name="filter" id="Length">
</div>

<label for="elevation">Elevation:</label>
<input type="range" min="1" max="30" value="15" class="slider" name="filter" id="Elevation">
</div>

<label for="time">Time:</label>
<input type="range" min="1" max="30" value="15" class="slider" name="filter" id="Time">
</div>

<label for="route type">Route Type:</label>
<select name="filter" id="RouteType">
    <option value="loop">Loop</option>
    <option value="out_and_back">Out and Back</option>
    <option value="point_to_point">Point to Point</option>
</select> 

<div id="map">
    <div class="dropDownControl" id="My Box">My Box<img src="http://maps.gstatic.com/mapfiles/arrow-down.png" class="dropDownArrow"></div>
    
</div>


<style type="text/css">
  /* Set the size of the div element that contains the map */
  #map {
    width: 100%;
    height: 500px;
}

.container-fluid {
	height: auto;
	background-color: #6ed3cf;
    padding: 5px 0px 5px 5px;
}

.footer {
    height: auto;
    bottom: 0;
    background-color: #6ed3cf;
}

.navbar-brand {
    height: 14px;
    color: #815DAB;
    font-size: 35px;
    size: 180%;
}


.navbar-brand-footer {
    font-size: 26px;
}

.container {
    width: 90%;
    margin-bottom: 10px;

}

html { 
	height: 100%;
	background-color: #7bce79;
}

body {
	height: 100%; 
	margin: 0px; 
	padding: 0px; 
	font-family:"arial", helvetica; 
	color:#000000; 
}

 

</style>

<script>
    "use strict";
    const trailslists = {{ trailslists|tojson }};

    $('input[name=filter]').change(function (e) {
        filterTrails(this.id);
    });

    $('select[name=filter]').change(function (e) {
        filterTrails(this.id);
    });

    // Initialize and add the map
    function initMap() {

        // The location of Uluru
        const uluru = {"lat": 45.51334993555411, "lng": -122.66478547235977 };
        // The map, centered at uluru
        let map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: uluru,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: true,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
                }
            });

        for (let i=0; i < trailslists.length; i++) {
            let position = new google.maps.LatLng(trailslists[i].long, trailslists[i].lat);

            let infowindow = getInfo(trailslists[i]);
            
            let marker = new google.maps.Marker({
                position: position,
                map,
                title: trailslists.name,
            });

            marker.addListener("click", () => {
                infowindow.open({
                anchor: marker,
                map,
                shouldFocus: false,
            })});

            marker.setMap(map);
        }
    }

    function getInfo(trail) {
        const contentString =
            `<div id="trailInfo"> 
            <ul style="list-style-type:none">
                <li><b>Trail Name: ${trail.name}</b>  </li>
                <li><b>Difficulty:  ${trail.dif}</b></li>
                <li><b>Length:  ${trail.len}</b></li>
                <li><b>Description:  ${trail.des}</b></li>
            </ul>
            </div>`
        const infowindow = new google.maps.InfoWindow({
            content: contentString,
        });

        return(infowindow);
    }

    function filterTrails(id) {
        console.log("Change on: " + id);
        const changedElement = document.getElementById(id);
        console.log(changedElement.value);
    };

    function filterCrimes(id_val) {
        if (crimeFilters[id_val]) {
          crimeFilters[id_val] = false
        } else {
          crimeFilters[id_val] = true
          crimesToFilter.push(id_val);
        }
        filterData(crimeData, crimesToFilter);
      }
</script>


<script src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&callback=initMap&libraries=&v=weekly" async></script>
{% endblock %}
